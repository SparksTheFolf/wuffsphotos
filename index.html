<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Furspective Photography</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Furspective Photography</h1>
    
    <div>
      <button onclick="loadGallery('ANE24')">ANE 2024</button>
      <button onclick="loadGallery('test')">Test</button>
    </div>

  </header>
  <br>
  <div id="gallery"></div>
  <br>
  <footer>
    <p>Â© 2024 Furspective Photography (A division of Sparks The Folf products)</p>
    <p><a href="https://photos.wuffs.net/Furspective-Photography-CopyrightNotice.txt">Images Copyright Notice</a></p>
  </footer>

  <script>

    async function loadGallery(folderName) {
      const galleryDiv = document.getElementById('gallery');
      galleryDiv.innerHTML = ''; // Clear previous gallery

      try {
        const response = await fetch(`/${folderName}/list.txt`);
        const data = await response.text();
        const photoNames = data.split(',').map(photoName => photoName.trim());

        if (photoNames.length === 0) {
          galleryDiv.innerHTML = `<p>No photos found in the ${folderName} folder.</p>`;
          return;
        }

        photoNames.forEach(photoName => {
          const imageContainer = document.createElement('div');
          imageContainer.classList.add('image-container');

          const img = document.createElement('img');
          img.src = `/${folderName}/${photoName}`;
          img.alt = photoName;

          imageContainer.appendChild(img);
          galleryDiv.appendChild(imageContainer);
        });

        // Call setupGallery to add click event listeners
        await setupGallery(folderName);
      } catch (error) {
        console.error('Error fetching photo list:', error);
        galleryDiv.innerHTML = '<p>Something went wrong while fetching photos.</p>';
      }
    }

    async function loadRandomGallery() {
      const maxImages = 25;
      const galleryDiv = document.getElementById('gallery');
      galleryDiv.innerHTML = ''; // Clear previous gallery
    
      const folders = ['ANE24', 'test'];
      const shuffledFolders = shuffleArray(folders);
    
      for (const folderName of shuffledFolders) {
        try {
          const response = await fetch(`/${folderName}/list.txt`);
          const data = await response.text();
          const photoNames = data.split(',').map(photoName => photoName.trim());
    
          if (photoNames.length === 0) {
            continue; // Skip folders with no photos
          }
    
          const numImagesToShow = Math.min(photoNames.length, maxImages);
          const shuffledPhotos = shuffleArray(photoNames).slice(0, numImagesToShow);
    
          for (const photoName of shuffledPhotos) {
            const imageContainer = document.createElement('div');
            imageContainer.classList.add('image-container');
    
            const img = document.createElement('img');
            img.src = `/${folderName}/${photoName}`;
            img.alt = photoName;
    
            imageContainer.appendChild(img);
            galleryDiv.appendChild(imageContainer);
          }
        } catch (error) {
          console.error('Error fetching photo list:', error);
        }
      }

      // Call setupGallery to add click event listeners
      await setupGallery(folders[0]); // Using the first folder for setup
    }

    async function setupGallery(folderName) {
      const fursonaInfo = await loadFursonaInfo(folderName);

      const images = document.querySelectorAll('.image-container img');
      images.forEach((img, index) => {
        img.addEventListener('click', () => openPopup(img.src, fursonaInfo[index + 1]));
      });
    }

    function shuffleArray(array) {
      const shuffled = array.slice();
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    async function loadFursonaInfo(folderName) {
      try {
        const response = await fetch(`/${folderName}/fursonaInfo.json`);
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error fetching fursona info:', error);
        return {};
      }
    }

    function openPopup(imageUrl, fursonaInfo) {
      const isCtrlKey = event.ctrlKey || event.metaKey;
      if (!isCtrlKey) {
        const popup = document.createElement('div');
        popup.classList.add('popup');

        const img = document.createElement('img');
        img.src = imageUrl;
        img.alt = 'Popup Image';
        img.classList.add('popup-image');

        const infoDiv = document.createElement('div');
        infoDiv.classList.add('popup-info');

        const fursonaName = fursonaInfo.Fursona || 'Unknown';
        const twitterHandle = fursonaInfo.TwitterHandle || 'N/A';
        const dateOfPicture = fursonaInfo.DateOfPicture || 'Unknown';

        infoDiv.innerHTML = `
          <p>Fursona Name: ${fursonaName}</p>
          <p>Twitter Handle: ${twitterHandle}</p>
          <p>Date of Picture: ${dateOfPicture}</p>
        `;

        popup.appendChild(img);
        popup.appendChild(infoDiv);
        document.body.appendChild(popup);

        popup.addEventListener('click', () => closePopup(popup));
      } else {
        window.open(imageUrl, '_blank');
      }
    }

    function closePopup(popup) {
      popup.remove();
    }

    window.addEventListener('DOMContentLoaded', loadRandomGallery);

  </script>
</body>
</html>
